<!DOCTYPE html>
<html>
<head>
  <title>Now Serving</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Malayalam font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Malayalam:wght@500;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: black;
      color: white;
      text-align: center;
      font-family: "Noto Sans Malayalam", Arial, sans-serif;
    }

    .title {
      font-size: 70px;
      margin-top: 80px;
      line-height: 1.2;
    }

    #token {
      font-size: 220px;
      color: yellow;
      margin: 20px 0;
    }

    .footer {
      font-size: 60px;
      line-height: 1.3;
    }
  </style>
</head>
<body>

<div class="title">
  ടോക്കൺ നമ്പർ<br>
  <span style="font-size:50px;">TOKEN NUMBER</span>
</div>

<div id="token">0</div>

<div class="footer">
  ദയവായി കൗണ്ടറിലേക്ക് സമീപിക്കുക<br>
  <span style="font-size:50px;">Please proceed to the counter</span>
</div>

<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDrkQuMiKfZC_NJqdKD87oHBsi-6P02t5g",
    authDomain: "token-system-b2122.firebaseapp.com",
    databaseURL: "https://token-system-b2122-default-rtdb.firebaseio.com",
    projectId: "token-system-b2122",
    storageBucket: "token-system-b2122.appspot.com",
    messagingSenderId: "573600353363",
    appId: "1:573600353363:web:7c4bec9266b74524610aa6"
  };

  firebase.initializeApp(firebaseConfig);

  let lastToken = null;

  function speak(text, lang) {
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = lang;
    msg.rate = 0.9;
    window.speechSynthesis.speak(msg);
  }

  firebase.database().ref("token").on("value", snap => {
    const token = snap.val() ?? 0;
    document.getElementById("token").innerText = token;

    // Announce only if token changed
    if (token !== lastToken && token !== 0) {
      window.speechSynthesis.cancel();

      // Malayalam announcement
      speak(`ടോക്കൺ നമ്പർ ${token}, ദയവായി കൗണ്ടറിലേക്ക് സമീപിക്കുക`, "ml-IN");

      // English announcement (slight delay)
      setTimeout(() => {
        speak(`Token number ${token}, please proceed to the counter`, "en-IN");
      }, 2500);

      lastToken = token;
    }
  });
</script>

</body>
</html>
